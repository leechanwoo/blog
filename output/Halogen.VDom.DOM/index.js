// Generated by purs version 0.12.5
"use strict";
var Data_Array = require("../Data.Array/index.js");
var Data_Maybe = require("../Data.Maybe/index.js");
var Data_Nullable = require("../Data.Nullable/index.js");
var Data_Tuple = require("../Data.Tuple/index.js");
var Effect = require("../Effect/index.js");
var Halogen_VDom_Machine = require("../Halogen.VDom.Machine/index.js");
var Halogen_VDom_Types = require("../Halogen.VDom.Types/index.js");
var Halogen_VDom_Util = require("../Halogen.VDom.Util/index.js");
var Web_DOM_Element = require("../Web.DOM.Element/index.js");
var VDomSpec = function (x) {
    return x;
};
var eqElemSpec = function (a, b) {
    if (a.value1 === b.value1) {
        if (a.value0 instanceof Data_Maybe.Just && (b.value0 instanceof Data_Maybe.Just && a.value0.value0 === b.value0.value0)) {
            return true;
        };
        if (a.value0 instanceof Data_Maybe.Nothing && b.value0 instanceof Data_Maybe.Nothing) {
            return true;
        };
        return false;
    };
    return false;
};
var buildWidget = (function () {
    var patch = function (build, v) {
        return function (v1) {
            if (v1 instanceof Halogen_VDom_Types.Grafted) {
                return patch(build, v)(Halogen_VDom_Types.runGraft(v1.value0));
            };
            if (v1 instanceof Halogen_VDom_Types.Widget) {
                var v2 = v.value1(v1.value0);
                return new Halogen_VDom_Machine.Step(v2.value0, patch(build, v2), v2.value2);
            };
            v.value2();
            return build(v1);
        };
    };
    var render = function (v, build, w) {
        var v1 = v.buildWidget(v)(w);
        return new Halogen_VDom_Machine.Step(v1.value0, patch(build, v1), v1.value2);
    };
    return render;
})();
var buildText = (function () {
    var patch = function (build, halt, node, s1) {
        return function (v) {
            if (v instanceof Halogen_VDom_Types.Grafted) {
                return patch(build, halt, node, s1)(Halogen_VDom_Types.runGraft(v.value0));
            };
            if (v instanceof Halogen_VDom_Types.Text) {
                var res = new Halogen_VDom_Machine.Step(node, patch(build, halt, node, v.value0), halt);
                var $84 = s1 === v.value0;
                if ($84) {
                    return res;
                };
                Halogen_VDom_Util.setTextContent(v.value0, node);
                return res;
            };
            halt();
            return build(v);
        };
    };
    var done = function (node) {
        return function __do() {
            var v = Halogen_VDom_Util.parentNode(node);
            return Halogen_VDom_Util.removeChild(node, v);
        };
    };
    var render = function (v, build, s) {
        var v1 = Halogen_VDom_Util.createTextNode(s, v.document);
        var halt = done(v1);
        return new Halogen_VDom_Machine.Step(v1, patch(build, halt, v1, s), halt);
    };
    return render;
})();
var buildKeyed = (function () {
    var done = function (node, attrs, steps) {
        return function __do() {
            var v = Halogen_VDom_Util.parentNode(node);
            Halogen_VDom_Util.removeChild(node, v);
            Halogen_VDom_Util.forInE(steps, function (v1, v2) {
                return v2.value2();
            });
            return Halogen_VDom_Machine.halt(attrs)();
        };
    };
    var patch = function (build, halt, node, attrs, v, ch1, len1) {
        return function (v1) {
            if (v1 instanceof Halogen_VDom_Types.Grafted) {
                return patch(build, halt, node, attrs, v, ch1, len1)(Halogen_VDom_Types.runGraft(v1.value0));
            };
            if (v1 instanceof Halogen_VDom_Types.Keyed && eqElemSpec(v, v1.value0)) {
                var v2 = Data_Array.length(v1.value1);
                if (len1 === 0 && v2 === 0) {
                    var v4 = Halogen_VDom_Machine.step(attrs)(v1.value0.value2);
                    var halt$prime = done(node, v4, ch1);
                    return new Halogen_VDom_Machine.Step(node, patch(build, halt$prime, node, v4, v1.value0, ch1, 0), halt$prime);
                };
                var onThis = function (v4, v5) {
                    return v5.value2();
                };
                var onThese = function (v4, ix$prime, v5, v6) {
                    var v7 = v5.value1(v6.value1);
                    Halogen_VDom_Util.insertChildIx(ix$prime, v7.value0, node);
                    return v7;
                };
                var onThat = function (v4, ix, v5) {
                    var v6 = build(v5.value1);
                    Halogen_VDom_Util.insertChildIx(ix, v6.value0, node);
                    return v6;
                };
                var v4 = Halogen_VDom_Util.diffWithKeyAndIxE(ch1, v1.value1, Data_Tuple.fst, onThese, onThis, onThat);
                var v5 = Halogen_VDom_Machine.step(attrs)(v1.value0.value2);
                var halt$prime = done(node, v5, v4);
                return new Halogen_VDom_Machine.Step(node, patch(build, halt$prime, node, v5, v1.value0, v4, v2), halt$prime);
            };
            halt();
            return build(v1);
        };
    };
    var render = function (v, build, v1, ch1) {
        var v2 = Halogen_VDom_Util.createElement(Data_Nullable.toNullable(v1.value0), v1.value1, v.document);
        var node = Web_DOM_Element.toNode(v2);
        var onChild = function (k, ix, v3) {
            var v4 = build(v3.value1);
            Halogen_VDom_Util.insertChildIx(ix, v4.value0, node);
            return v4;
        };
        var v3 = Halogen_VDom_Util.strMapWithIxE(ch1, Data_Tuple.fst, onChild);
        var v4 = v.buildAttributes(v2)(v1.value2);
        var halt = done(node, v4, v3);
        return new Halogen_VDom_Machine.Step(node, patch(build, halt, node, v4, v1, v3, Data_Array.length(ch1)), halt);
    };
    return render;
})();
var buildElem = (function () {
    var done = function (node, attrs, steps) {
        return function __do() {
            var v = Halogen_VDom_Util.parentNode(node);
            Halogen_VDom_Util.removeChild(node, v);
            Effect.foreachE(steps)(Halogen_VDom_Machine.halt)();
            return Halogen_VDom_Machine.halt(attrs)();
        };
    };
    var patch = function (build, halt, node, attrs, v, ch1) {
        return function (v1) {
            if (v1 instanceof Halogen_VDom_Types.Grafted) {
                return patch(build, halt, node, attrs, v, ch1)(Halogen_VDom_Types.runGraft(v1.value0));
            };
            if (v1 instanceof Halogen_VDom_Types.Elem && eqElemSpec(v, v1.value0)) {
                var v2 = Data_Array.length(v1.value1);
                var v3 = Data_Array.length(ch1);
                if (v3 === 0 && v2 === 0) {
                    var v4 = Halogen_VDom_Machine.step(attrs)(v1.value0.value2);
                    var halt$prime = done(node, v4, ch1);
                    return new Halogen_VDom_Machine.Step(node, patch(build, halt$prime, node, v4, v1.value0, ch1), halt$prime);
                };
                var onThis = function (ix, v4) {
                    return v4.value2();
                };
                var onThese = function (ix, v4, vdom) {
                    var v5 = v4.value1(vdom);
                    Halogen_VDom_Util.insertChildIx(ix, v5.value0, node);
                    return v5;
                };
                var onThat = function (ix, vdom) {
                    var v4 = build(vdom);
                    Halogen_VDom_Util.insertChildIx(ix, v4.value0, node);
                    return v4;
                };
                var v4 = Halogen_VDom_Util.diffWithIxE(ch1, v1.value1, onThese, onThis, onThat);
                var v5 = Halogen_VDom_Machine.step(attrs)(v1.value0.value2);
                var halt$prime = done(node, v5, v4);
                return new Halogen_VDom_Machine.Step(node, patch(build, halt$prime, node, v5, v1.value0, v4), halt$prime);
            };
            halt();
            return build(v1);
        };
    };
    var render = function (v, build, v1, ch1) {
        var v2 = Halogen_VDom_Util.createElement(Data_Nullable.toNullable(v1.value0), v1.value1, v.document);
        var node = Web_DOM_Element.toNode(v2);
        var onChild = function (ix, child) {
            var v3 = build(child);
            Halogen_VDom_Util.insertChildIx(ix, v3.value0, node);
            return v3;
        };
        var v3 = Halogen_VDom_Util.forE(ch1, onChild);
        var v4 = v.buildAttributes(v2)(v1.value2);
        var halt = done(node, v4, v3);
        return new Halogen_VDom_Machine.Step(node, patch(build, halt, node, v4, v1, v3), halt);
    };
    return render;
})();
var buildVDom = function (spec) {
    var build = function (v) {
        if (v instanceof Halogen_VDom_Types.Text) {
            return buildText(spec, build, v.value0);
        };
        if (v instanceof Halogen_VDom_Types.Elem) {
            return buildElem(spec, build, v.value0, v.value1);
        };
        if (v instanceof Halogen_VDom_Types.Keyed) {
            return buildKeyed(spec, build, v.value0, v.value1);
        };
        if (v instanceof Halogen_VDom_Types.Widget) {
            return buildWidget(spec, build, v.value0);
        };
        if (v instanceof Halogen_VDom_Types.Grafted) {
            return build(Halogen_VDom_Types.runGraft(v.value0));
        };
        throw new Error("Failed pattern match at Halogen.VDom.DOM (line 58, column 27 - line 63, column 52): " + [ v.constructor.name ]);
    };
    return build;
};
module.exports = {
    VDomSpec: VDomSpec,
    buildVDom: buildVDom,
    buildText: buildText,
    buildElem: buildElem,
    buildKeyed: buildKeyed,
    buildWidget: buildWidget
};
